# 任务 11.1 知识框架展示 — 验收检查清单

本文档对应 [tasks.md](../../.kiro/specs/agentic-edu-helper/tasks.md) 11.1 各子项，用于手工或自动化验收。

## 前置条件

- FastAPI 已启动：`uvicorn src.api.app:app --host 0.0.0.0 --port 8000`
- Dash 已启动：`python -m src.web.app`（端口 8050）
- 环境变量 `API_BASE_URL=http://127.0.0.1:8000`（若 Dash 与 API 同机）
- Neo4j 已启动且已导入知识图谱（否则子图/学习路径接口返回空或 503）

---

## 11.1.1 知识图谱可视化组件

| 编号 | 验收内容 | 通过条件 | 测试步骤 |
|------|----------|----------|----------|
| 11.1.1.1 | 使用 Cytoscape（dash-cytoscape）渲染图谱 | 依赖中有 dash-cytoscape；「知识图谱」Tab 内能渲染节点与边 | 1. 打开 http://127.0.0.1:8050 2. 切换到「知识图谱」Tab 3. 点击「加载子图」4. 图中出现节点与边 |
| 11.1.1.2 | 增量加载，不加载全图 | 仅通过子图 API 按需加载，无「加载全图」入口 | 1. 仅存在「加载子图」按钮与节点点击展开 2. 网络请求仅见 `/api/graph/subgraph` |
| 11.1.1.3 | 分页/有界查询 | 子图由参数控制规模 | 1. 请求带 `max_depth`、`max_nodes` 2. 文档或代码注释说明由子图+上限防止全图加载 |
| 11.1.1.4 | 节点数量上限 50 | 单次展示不超过 50 节点 | 1. 调用 `GET /api/graph/subgraph?seed_id=lec01&max_nodes=50` 2. 断言 `len(response["nodes"]) <= 50` 3. 前端合并展开后仍 ≤ 50（可查 Store 或图中节点数） |

---

## 11.1.2 交互式图谱浏览

| 编号 | 验收内容 | 通过条件 | 测试步骤 |
|------|----------|----------|----------|
| 11.1.2.1 | 节点点击展开 | 点击节点可加载相邻并合并展示，总数仍 ≤ 50 | 1. 先加载子图 2. 点击某一节点 3. 图中出现新节点/边 4. 节点总数 ≤ 50 |
| 11.1.2.2 | 缩放和平移 | 图谱可缩放、平移 | 1. 滚轮缩放 2. 拖拽画布平移 3. 无报错、交互正常 |
| 11.1.2.3 | 节点搜索与高亮 | 支持搜索并高亮节点 | 1. 在「搜索节点」输入框输入某节点 id（如 lec02）2. 对应节点高亮（边框/样式区分） |
| 11.1.2.4 | 按类型/关系过滤 | 可按节点类型过滤 | 1. 取消勾选某一类型（如 Concept）2. 图中仅显示勾选类型的节点及相连边（或未勾选类型被隐藏） |

---

## 11.1.3 学习路径可视化

| 编号 | 验收内容 | 通过条件 | 测试步骤 |
|------|----------|----------|----------|
| 11.1.3.1 | 高亮当前学习位置 | 当前学习节点高亮 | 1. 在「当前学习位置」选择 lec02 2. 图中 lec02 节点样式区分（如边框/颜色） |
| 11.1.3.2 | 推荐下一步路径 | 展示推荐学习路径 | 1. 选择「当前学习位置」后 2. path 中节点或路径边在图中高亮（如 path class） |
| 11.1.3.3 | 已完成/未完成状态 | 节点状态区分 | 若有已学 topic 数据源，图中已学/未学节点样式不同；若无数据源可标为可选或用 mock 验收 |

---

## 11.1.4 内存优化和性能控制

| 编号 | 验收内容 | 通过条件 | 测试步骤 |
|------|----------|----------|----------|
| 11.1.4.2 | 限制渲染节点数 | 同时渲染 ≤ 50 | 同 11.1.1.4；任意时刻 Cytoscape 节点数 ≤ 50 |
| 11.1.4.3 | 懒加载/缓存 | 按需加载、当前子图在 Store | 1. 子图通过按钮/点击加载 2. 当前子图保存在前端 Store，不要求持久化 |

---

## 接口测试（可自动化）

子图 API 可用 pytest + TestClient 或 httpx 断言：

- `GET /api/graph/subgraph?seed_id=lec01&max_depth=2&max_nodes=50`
  - 断言：`len(res.json()["nodes"]) <= 50`
  - 断言：`"nodes" in res.json()`，`"edges" in res.json()`
  - 断言：每个 node 含 `id`、`label`、`type`；每条 edge 含 `source`、`target`、`type`

学习路径 API：

- `GET /api/graph/learning-path?topic_id=lec02`
  - 断言：`"path" in res.json()`，且为列表

详见 `tests/api/test_graph_subgraph.py`。
